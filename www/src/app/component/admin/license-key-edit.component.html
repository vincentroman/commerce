<div class="page-header">
    <div class="btn-toolbar pull-right">
        <button type="button" class="btn btn-danger btn-lg" (click)="delete()" [hidden]="!entity.uuid" title="Delete"><span class="glyphicon glyphicon-remove"></span></button>
        <a routerLink="/admin/licensekeys" class="btn btn-primary btn-lg" title="Show all"><span class="glyphicon glyphicon-list"></span></a>
        <a routerLink="/admin/licensekeys/new" class="btn btn-primary btn-lg" [hidden]="!entity.uuid" title="Add new"><span class="glyphicon glyphicon-plus"></span></a>
    </div>
    <h1 [hidden]="entity.uuid">Add License Key</h1>
    <h1 [hidden]="!entity.uuid">Edit License Key</h1>
</div>
<form (ngSubmit)="submit()" #form="ngForm">
    <div class="alert alert-success" role="alert" [hidden]="!success">License Key saved successfully.</div>
    <div class="alert alert-danger" role="alert" [hidden]="!error">Error saving license key. Please try again.</div>
    <div *ngIf="!model.licenseKey">
        <div class="form-group">
            <label for="productVariant">Product Variant</label>
            <select id="productVariant" name="productVariant" class="form-control" required="required" autofocus="autofocus" [(ngModel)]="model.productVariantId">
                <option value="" selected="selected">(please select)</option>
                <optgroup *ngFor="let product of getProductsWithLicenseVariants()" label="{{product.title}}">
                    <option *ngFor="let variant of getProductVariantsForProduct(product.uuid)" value="{{variant.uuid}}">{{variant.title}}</option>
                </optgroup>
            </select>
        </div>
        <div class="form-group">
            <label>Mode</label>
            <div class="btn-group" role="group">
                <button class="btn btn-default" type="button" (click)="setMode('assign')" [ngClass]="{'btn-primary' : model.mode == 'assign'}">Assign license to customer</button>
                <button class="btn btn-default" type="button" (click)="setMode('generate')" [ngClass]="{'btn-primary' : model.mode == 'generate'}">Generate license key</button>
            </div>
        </div>
        <div [hidden]="model.mode != 'assign'">
            <div class="form-group">
                <label for="customer">Customer</label>
                <input type="text" class="form-control typeahead" id="customer" name="customer" autocomplete="off" />
            </div>
        </div>
        <div [hidden]="model.mode != 'generate'">
            <div class="form-group">
                <label for="licenseType">License Type</label>
                <select id="licenseType" name="licenseType" class="form-control" [required]="model.mode == 'generate'" [(ngModel)]="model.licenseType">
                    <option *ngFor="let licenseType of licenseTypes" value="{{licenseType.id}}">{{licenseType.label}}</option>
                </select>
            </div>
            <div class="form-group">
                <label for="owner">Owner</label>
                <input type="text" id="owner" name="owner" placeholder="Owner" class="form-control" [(ngModel)]="model.owner" [required]="model.mode == 'generate'" />
            </div>
            <div class="form-group">
                <label for="validMonths">Valid for x months</label>
                <input type="number" id="validMonths" name="validMonths" placeholder="Valid for x months" class="form-control" [(ngModel)]="model.validMonths" [required]="model.mode == 'generate'" min="0" max="999999" step="1" />
            </div>
            <div class="checkbox">
                <label>
                    <input type="checkbox" id="wildcard" name="wildcard" [(ngModel)]="model.wildcard" /> Wildcard License
                </label>
            </div>
            <div class="form-group">
                <label for="domains">Domains (one per line)</label>
                <textarea id="domains" name="domains" placeholder="Domains" class="form-control" [(ngModel)]="model.domains" [required]="model.mode == 'generate'" rows="5" [disabled]="model.wildcard"></textarea>
            </div>
            <div class="form-group">
                <label for="uuid">UUID (optional)</label>
                <input type="text" id="uuid" name="uuid" placeholder="UUID" class="form-control" [(ngModel)]="model.uuid" />
            </div>
            <div class="checkbox">
                <label>
                    <input type="checkbox" id="onlineVerification" name="onlineVerification" [(ngModel)]="model.onlineVerification" /> Online Verification
                </label>
            </div>
        </div>
        <a routerLink="/admin/licensekeys" class="btn btn-default">Cancel</a>
        <button type="submit" class="btn btn-default" [disabled]="!form.valid || submitting" *ngIf="model.mode == 'generate'"><span class="glyphicon glyphicon-ok"></span> Generate</button>
        <button type="submit" class="btn btn-default" [disabled]="!form.valid || submitting" *ngIf="model.mode == 'assign'"><span class="glyphicon glyphicon-ok"></span> Save</button>
    </div>
    <div *ngIf="model.licenseKey">
        <div class="form-group">
            <label for="licenseKey">License Key</label>
            <textarea id="licenseKey" name="licenseKey" placeholder="License Key" readonly="readonly" class="form-control" [(ngModel)]="model.licenseKey" rows="20" (click)="this.select()"></textarea>
        </div>
    </div>
</form>